---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("posts", ({ data }) => !data.draft);

const tagCounts = new Map<string, number>();
posts.forEach((post) => {
  post.data.tags.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

const sortedTags = [...tagCounts.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="Tags - CyberDan" description="Browse posts by tag">
  <h1 class="text-3xl font-bold text-(--color-text) sm:text-4xl">Tags</h1>

  <div class="mt-8 flex flex-wrap gap-3">
    {sortedTags.map(([tag, count]) => (
      <a
        href={`/tags/${tag}`}
        class="inline-flex items-center gap-2 rounded-lg border border-(--color-border) px-4 py-2 text-(--color-text-secondary) hover:text-(--color-accent) hover:border-(--color-accent) transition-colors"
      >
        <span>{tag}</span>
        <span class="rounded-full bg-(--color-bg-secondary) px-2 py-0.5 text-xs">{count}</span>
      </a>
    ))}
  </div>

  {sortedTags.length === 0 && (
    <p class="mt-8 text-(--color-text-secondary)">No tags yet.</p>
  )}
</BaseLayout>
