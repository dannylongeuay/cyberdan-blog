---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const allTags = [...new Set(posts.flatMap((post) => post.data.tags))].sort();
---

<BaseLayout title="Blog - CyberDan" description="All blog posts">
  <h1 class="text-3xl font-bold text-(--color-text) sm:text-4xl">Blog</h1>

  {allTags.length > 0 && (
    <div class="mt-4 flex flex-wrap gap-2">
      {allTags.map((tag) => (
        <a
          href={`/tags/${tag}`}
          class="inline-block rounded-full bg-(--color-bg-secondary) border border-(--color-border) px-3 py-1 text-sm text-(--color-text-secondary) hover:text-(--color-accent) hover:border-(--color-accent) transition-colors"
        >
          {tag}
        </a>
      ))}
    </div>
  )}

  <div class="mt-8 flex flex-col gap-4">
    {posts.map((post) => (
      <PostCard
        title={post.data.title}
        description={post.data.description}
        pubDate={post.data.pubDate}
        tags={post.data.tags}
        slug={post.id}
      />
    ))}
  </div>

  {posts.length === 0 && (
    <p class="mt-8 text-(--color-text-secondary)">No posts yet. Check back soon!</p>
  )}
</BaseLayout>
